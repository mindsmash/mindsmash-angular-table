/**
 * @name mindsmash-table
 * @version v0.3.3
 * @author mindsmash GmbH
 * @license MIT
 */
!function(e){"use strict";function t(t,i){function o(t){e.extend({},r,t)}function a(e,t,i,o){return new n(e,t,i,o,r)}a.$inject=["$rootScope","$filter","$q","$window"];var r=t;return{setTableConfig:o,$get:a}}function n(t,n,o,a,r){function l(l,s){return new i(t,n,o,a,l,e.extend({},r,s))}return{get:l}}function i(t,n,i,o,a,r){function l(){return r}function s(){return ee}function c(){return ne}function m(){return ne}function u(){return ae.rowCount}function d(){var t=r.onBeforeLoad(e.extend({page:ae.page,size:ae.pageSize,sort:ae.orderBy?ae.orderBy.key+(ae.orderBy.asc?",asc":",desc"):null},ie),_),n=e.isArray(r.source)?Q(t):r.source(t);return Y("loading",!0),n.then(function(t){t=r.onAfterLoad(t,_),ne=t.content,Y("items");var n={page:"number",pageSize:"size",rowCount:"totalElements",orderBy:function(e){if(e.sort&&e.sort.length){var t=e.sort[0];return{key:t.property,asc:t.ascending}}return null}};for(var i in n)if(n.hasOwnProperty(i)){var o=ae[i],a=n[i],l=e.isFunction(a)?a(t):t[a];e.equals(o,l)||(ae[i]=l,Y(i,l))}var s=X();null!==ae.active&&ae.active>=s&&(ae.active=s-1,Y("active",ae.active))})["finally"](function(){Y("loading",!1)})}function g(){var e=null!==oe?oe[ee]:null;return e?JSON.parse(e):{}}function p(){null!==oe&&(oe[ee]=JSON.stringify({page:ae.page,pageSize:ae.pageSize,orderBy:ae.orderBy}))}function v(t){return e.isDefined(t)?ie[t]:ie}function b(e,t){ie[e]=t}function f(t){e.isDefined(t)?delete ie[t]:ie={}}function y(){return ae.page}function $(e){var t=i.defer(),n=Math.min(Math.max(0,e),W()-1);return ae.page!==n?(ae.page=n,t.resolve(d())):t.reject(n),t.promise.then(function(e){return Z("page",n),e})}function h(){return $(0)}function S(){return $(ae.page-1)}function z(){return $(ae.page+1)}function w(){return $(W()-1)}function k(){return ae.pageSize}function B(e){var t=i.defer(),n=Math.max(1,e);return ae.pageSize!==n?(ae.pageSize=n,t.resolve(d())):t.reject(n),t.promise.then(function(e){return Z("pageSize",n),e})}function A(t){return e.isDefined(t)?!!ae.visibility[t]:ae.visibility}function C(t,n){var o=i.defer(),a=e.isDefined(n)?!!n:!ae.visibility[t];if(ae.visibility[t]!==a)ae.visibility[t]=a,o.resolve();else{var r={};r[t]=a,o.reject(r)}return o.promise.then(function(e){return Y("visibility",ae.visibility),e})}function P(){return ae.orderBy}function T(t,n){var o,a=i.defer();return ae.orderBy?o=e.isUndefined(t)||null===t||null===n?null:ae.orderBy.key!==t?{key:t,asc:e.isUndefined(n)||!!n}:e.isDefined(n)&&ae.orderBy.asc!==n?{key:ae.orderBy.key,asc:n}:ae.orderBy.asc?{key:ae.orderBy.key,asc:!1}:null:e.isDefined(t)&&null!==t&&null!==n&&(o={key:t,asc:e.isUndefined(n)||!!n}),e.isDefined(o)?(ae.orderBy=o,a.resolve(d())):a.reject({key:t,asc:e.isUndefined(n)||!!n}),a.promise.then(function(e){return Z("orderBy",o),e})}function E(){return T(null)}function L(){return ae.active}function x(e){var t,n=i.defer(),o=!1,a=!1,r=X();return null===e?t=null!==ae.active?null:ae.active:0>e?(o=ae.page>0,t=o?ae.pageSize-1:null!==e?0:null):e>=r?(a=ae.page<W()-1,t=a?0:null!==e?r-1:null):t=Math.min(e,ne.length-1),ae.active!==t?(ae.active=t,o?n.resolve(S()):a?n.resolve(z()):n.resolve()):n.reject(t),n.promise.then(function(e){return Y("active",t),e})}function N(){return x(0)}function j(){return x(null!==ae.active?ae.active-1:0)}function U(){return x(null!==ae.active?ae.active+1:0)}function D(){return x(X()-1)}function M(){return x(null)}function q(t){return e.isDefined(t)?!!ae.selection[t]:ae.selection}function O(t,n){var o=i.defer(),a=e.isDefined(n)?!!n:!ae.selection[t];if(ae.selection[t]!==a)ae.selection[t]=a,o.resolve();else{var r={};r[t]=a,o.reject(r)}return o.promise.then(function(e){return Y("selection",ae.selection),e})}function V(e){var t=i.defer();return null!==ae.active?O(ne[ae.active][r.selection],e):void t.reject(e)}function R(){var e=i.defer();return ae.selection!=={}?(ae.selection={},e.resolve()):e.reject(),e.promise.then(function(e){return Y("selection",ae.selection),e})}function F(){return r.namespace+"."+a}function H(){return r.columns}function I(){return[]}function J(){return{}}function K(){switch(r.storage){case"session":return sessionStorage;case"local":return localStorage;default:return null}}function G(){return e.extend({page:r.page,pageSize:r.pageSizes[0],rowCount:0,orderBy:r.orderBy,active:r.active,selection:{},visibility:function(){for(var e={},t=0;t<te.length;t++)e[te[t].key]=te[t].show!==!1;return e}()},g())}function Q(e){var t=r.source;return i(function(i){var o=e.page*e.size,a=o+e.size,r=Math.ceil(t.length/e.size),l=e.sort?e.sort.split(","):null,s=l?n("orderBy")(t,l[0],"asc"!==l[1]):t;s=s.slice(o,a),i({content:s,first:0===e.page,last:e.page===r-1,number:e.page,numberOfElements:s.length,size:e.size,sort:l?[{direction:l[1].toUpperCase(),property:l[0],ascending:"asc"===l[1]}]:null,totalElements:t.length,totalPages:r})})}function W(){return Math.ceil(ae.rowCount/ae.pageSize)}function X(){return ae.page<W()-1?ae.pageSize:ae.rowCount%ae.pageSize}function Y(e,n){t.$emit(ee+"."+e,n)}function Z(e,t){Y(e,t),p()}var _=this,ee=F(),te=H(),ne=I(),ie=J(),oe=K(),ae=G();_.getConfig=l,_.getName=s,_.getCols=c,_.getRows=m,_.getRowCount=u,_.reload=d,_.getParam=v,_.setParam=b,_.clearParam=f,_.getPage=y,_.setPage=$,_.firstPage=h,_.previousPage=S,_.nextPage=z,_.lastPage=w,_.getPageSize=k,_.setPageSize=B,_.getVisibility=A,_.setVisibility=C,r.orderBy!==!1&&(_.getOrderBy=P,_.setOrderBy=T,_.clearOrderBy=E),r.active!==!1&&(_.getActive=L,_.setActive=x,_.firstActive=N,_.previousActive=j,_.nextActive=U,_.lastActive=D,_.clearActive=M),r.selection!==!1&&(_.getSelection=q,_.setSelection=O,_.clearSelection=R,r.active!==!1&&(_.setActiveSelection=V)),r.onInit(_),_.reload()}function o(){return{restrict:"E",controller:a,controllerAs:"vm",templateUrl:"msm-table-column-selector/msm-table-column-selector.html",scope:{api:"&"}}}function a(e,t){function n(e,t){t.preventDefault();var n=!i.visibility[e];if(!n)for(var a=Object.keys(i.visibility);!n&&a.length>0;){var r=a.shift();n=r!==e&&i.visibility[r]}return n?o.setVisibility(e):void 0}var i=this,o=t.api(),a=o.getConfig();i.isLoading=!1,i.cols=a.columns,i.visibility=o.getVisibility(),i.select=n;var r=e.$on(o.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(o.getName()+".visibility",function(e,t){i.visibility=t});t.$on("$destroy",r),t.$on("$destroy",l)}function r(){return{restrict:"E",controller:l,controllerAs:"vm",templateUrl:"msm-table-pagination/msm-table-pagination.html",scope:{api:"&"}}}function l(e,t){var n=this,i=1,o=t.api();o.getConfig();n.isLoading=!1,n.page=o.getPage()+i,n.pageSize=o.getPageSize(),n.rowCount=o.getRowCount(),t.$watch("vm.page",function(e,t){e!==t&&o.setPage(e-i)});var a=e.$on(o.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(o.getName()+".page",function(e,t){n.page=t+i}),l=e.$on(o.getName()+".pageSize",function(e,t){n.pageSize=t}),s=e.$on(o.getName()+".rowCount",function(e,t){n.rowCount=t});t.$on("$destroy",a),t.$on("$destroy",r),t.$on("$destroy",l),t.$on("$destroy",s)}function s(){return{restrict:"E",controller:c,controllerAs:"vm",templateUrl:"msm-table-pager/msm-table-pager.html",scope:{api:"&"}}}function c(e,t){var n=this,i=1,o=t.api();o.getConfig();n.isLoading=!1,n.page=o.getPage()+i,n.pageSize=o.getPageSize(),n.rowCount=o.getRowCount(),t.$watch("vm.page",function(e,t){e!==t&&o.setPage(e-i)});var a=e.$on(o.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(o.getName()+".page",function(e,t){n.page=t+i}),l=e.$on(o.getName()+".pageSize",function(e,t){n.pageSize=t}),s=e.$on(o.getName()+".rowCount",function(e,t){n.rowCount=t});t.$on("$destroy",a),t.$on("$destroy",r),t.$on("$destroy",l),t.$on("$destroy",s)}function m(){return{restrict:"E",controller:u,controllerAs:"vm",templateUrl:"msm-table-pagination-size/msm-table-pagination-size.html",scope:{api:"&"}}}function u(e,t){function n(e,t){t.preventDefault(),i.pageSize=e,o.setPageSize(e)}var i=this,o=t.api(),a=o.getConfig();i.isLoading=!1,i.pageSize=o.getPageSize(),i.pageSizes=a.pageSizes,i.select=n;var r=e.$on(o.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(o.getName()+".pageSize",function(e,t){i.pageSize=t});t.$on("$destroy",r),t.$on("$destroy",l)}function d(){return{restrict:"E",controller:g,controllerAs:"vm",templateUrl:"msm-table-view/msm-table-view.html",scope:{api:"&"}}}function g(e,t,n,i,o){function a(e,t){return n("filter")(e,function(e){return t[e.key]})}function r(){return null===m.active?u.lastActive():u.firstActive()}function l(){return null===m.active?u.firstActive():u.lastActive()}function s(e){return d.onAction(m.rows[u.getActive()],e)}function c(e,t){return function(n){m.isLoading||t&&null===u.getActive()||(n.preventDefault(),e())}}var m=this,u=t.api(),d=u.getConfig();m.isLoading=!1,m.name=u.getName(),m.cols=a(d.columns,u.getVisibility()),m.rows=u.getRows(),m.orderByEnabled=d.orderBy!==!1,m.orderByEnabled&&(m.orderBy=u.getOrderBy(),m.setOrderBy=u.setOrderBy),m.activeEnabled=d.active!==!1,m.activeEnabled&&(m.active=u.getActive(),m.setActive=u.setActive,m.clearActive=u.clearActive),m.selectionEnabled=d.selection!==!1,m.selectionEnabled&&(m.selectionKey=d.selection,m.selection=u.getSelection(),m.setSelection=u.setSelection,m.clearSelection=u.clearSelection),m.isMobile=!1,m.mobileSize=d.mobileSize,m.mobileTemplateUrl=d.mobileTemplateUrl,m.mobileSize&&m.mobileTemplateUrl&&(m.isMobile=o.is(m.mobileSize),o.on(m.mobileSize,function(e){m.isMobile!==e&&(m.isMobile=e)})),i.bindTo(t).add({combo:"shift+left",callback:c(u.firstPage)}).add({combo:"left",callback:c(u.previousPage)}).add({combo:"right",callback:c(u.nextPage)}).add({combo:"shift+right",callback:c(u.lastPage)}),m.activeEnabled&&i.bindTo(t).add({combo:"shift+up",callback:c(r)}).add({combo:"up",callback:c(u.previousActive,!0)}).add({combo:"down",callback:c(u.nextActive,!0)}).add({combo:"shift+down",callback:c(l)}).add({combo:"esc",callback:u.clearActive}).add({combo:"return",callback:c(s,!0)}),m.selectionEnabled&&i.bindTo(t).add({combo:"shift+esc",callback:u.clearSelection}),m.activeEnabled&&m.selectionEnabled&&i.bindTo(t).add({combo:"space",callback:c(u.setActiveSelection)});var g=e.$on(u.getName()+".loading",function(e,t){m.isLoading=t}),p=e.$on(u.getName()+".items",function(e){m.rows=u.getRows()}),v=e.$on(u.getName()+".orderBy",function(e,t){m.orderBy=t}),b=e.$on(u.getName()+".active",function(e,t){m.active=t}),f=e.$on(u.getName()+".visibility",function(e,t){m.cols=a(d.columns,t)}),y=e.$on(u.getName()+".selection",function(e,t){m.selection=t});t.$on("$destroy",g),t.$on("$destroy",p),t.$on("$destroy",v),t.$on("$destroy",b),t.$on("$destroy",f),t.$on("$destroy",y)}function p(t,n){return{restrict:"A",require:"^msmTableView",scope:!1,link:function(i,o,a){var r=i.col.templateUrl,l=i.col.template;e.isDefined(r)?n(r).then(function(e){o[0].innerHTML=e,t(o.contents())(i)}):e.isDefined(l)&&(o[0].innerHTML=l,t(o.contents())(i))}}}t.$inject=["msmTableConfig","$translateProvider"],a.$inject=["$rootScope","$scope"],l.$inject=["$rootScope","$scope"],c.$inject=["$rootScope","$scope"],u.$inject=["$rootScope","$scope"],g.$inject=["$rootScope","$scope","$filter","hotkeys","screenSize"],p.$inject=["$compile","$templateRequest"],e.module("mindsmash-table",["ui.bootstrap.dropdown","ui.bootstrap.pager","ui.bootstrap.pagination","ui.bootstrap.tpls","angular-click-outside","cfp.hotkeys","matchMedia","pascalprecht.translate"]),e.module("mindsmash-table").run(["$templateCache",function(e){e.put("msm-table-column-selector/msm-table-column-selector.html",'<div class="btn-group" uib-dropdown auto-close="outsideClick"><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading"><span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="col in vm.cols" role="menuitem" ng-class="{ \'disabled\': col.sticky, \'msm-table-isSelected\': vm.visibility[col.key] }"><a href="#" ng-click="!col.sticky && vm.select(col.key, $event)" translate="{{ col.name }}"></a></li></ul></div>'),e.put("msm-table-pager/msm-table-pager.html",'<uib-pager ng-model="vm.page" total-items="vm.rowCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pager.previous\' | translate }}" next-text="{{ \'msmTable.pager.next\' | translate }}"></uib-pager>'),e.put("msm-table-pagination/msm-table-pagination.html",'<uib-pagination ng-show="vm.pageSize < vm.rowCount" ng-model="vm.page" total-items="vm.rowCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pagination.previous\' | translate }}" next-text="{{ \'msmTable.pagination.next\' | translate }}" rotate="true" max-size="5"></uib-pagination>'),e.put("msm-table-pagination-size/msm-table-pagination-size.html",'<div class="btn-group" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading">{{ vm.pageSize }} <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="pageSize in vm.pageSizes" role="menuitem" ng-class="{ \'msm-table-isSelected\': pageSize === vm.pageSize }"><a href="#" ng-click="vm.select(pageSize, $event)">{{ pageSize }}</a></li></ul></div>'),e.put("msm-table-view/msm-table-view.html",'<div><table id="{{ vm.name }}" class="table msm-table-table-view" ng-class="{ \'msm-table-isLoading\': vm.isLoading }" ng-if="!vm.isMobile" click-outside="vm.clearActive()"><thead><tr><th class="msm-table-selector-all" ng-show="vm.selectionEnabled"></th><th ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" ng-class="{\'msm-table-isSortable\': vm.orderByEnabled && col.sort !== false,\'msm-table-isSortedAsc\': vm.orderBy.key === (col.sort || col.key) && vm.orderBy.asc === true,\'msm-table-isSortedDesc\': vm.orderBy.key === (col.sort || col.key) && vm.orderBy.asc === false }" ng-click="vm.orderByEnabled && col.sort !== false && vm.setOrderBy(col.sort || col.key)" translate="{{ col.name }}"></th></tr></thead><thead class="msm-table-loading-bar"><tr><th colspan="{{ vm.cols.length + 1 }}"><div class="msm-table-progress"><div class="msm-table-container"><div class="msm-table-bar msm-table-bar1"></div><div class="msm-table-bar msm-table-bar2"></div></div></div></th></tr></thead><tbody><tr ng-repeat="row in vm.rows" ng-class="{ \'msm-table-isActive\': vm.active === $index, \'msm-table-isSelected\': vm.selection[row.id] }" ng-click="vm.activeEnabled && vm.setActive($index)"><td class="msm-table-selector" ng-show="vm.selectionEnabled" ng-click="vm.setSelection(row[vm.selectionKey])"></td><td ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" data-label="{{ col.name | translate }}" msm-table-view-cell>{{ row[col.key] }}</td></tr></tbody></table><ol class="list-unstyled msm-table-list-view" ng-if="vm.isMobile"><li ng-repeat="row in vm.rows" ng-include="vm.mobileTemplateUrl"></li></ol></div>')}]),e.module("mindsmash-table").provider("msmTableFactory",t),e.module("mindsmash-table").directive("msmTableColumnSelector",o),e.module("mindsmash-table").constant("msmTableConfig",{namespace:"msmTable",source:e.noop,columns:[],onInit:e.noop,onAction:e.noop,onBeforeLoad:e.identity,onAfterLoad:e.identity,page:0,pageSizes:[10,25,50,100],orderBy:null,active:null,selection:"id",storage:"session",mobileSize:"xs",mobileTemplateUrl:null}),e.module("mindsmash-table").directive("msmTablePagination",r),e.module("mindsmash-table").directive("msmTablePager",s),e.module("mindsmash-table").directive("msmTablePaginationSize",m),e.module("mindsmash-table").directive("msmTableView",d),e.module("mindsmash-table").directive("msmTableViewCell",p)}(angular);
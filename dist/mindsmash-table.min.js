/**
 * @name mindsmash-table
 * @version v0.2.0
 * @author mindsmash GmbH
 * @license MIT
 */
!function(e){"use strict";function t(t,n){function o(t){e.merge(l,t)}function a(e,t,n){return new i(e,t,n,l)}a.$inject=["$rootScope","$q","$window"];var l=t;return n.translations("en",{"msmTable.pagination.previous":"«","msmTable.pagination.next":"»","msmTable.pager.previous":"« Previous","msmTable.pager.next":"Next »"}),{setTableConfig:o,$get:a}}function i(t,i,o,a){function l(l,r){return new n(t,i,o,l,e.merge(a,r))}return{get:l}}function n(t,i,n,o,a){function l(){return a}function r(){return J}function s(){return F}function c(){return F}function m(){return Q.itemCount}function u(){var e={page:Q.page,pageSize:Q.pageSize};return Q.orderBy&&(e.orderBy=Q.orderBy.key,e.orderAsc=Q.orderBy.asc),e}function d(){return R("loading",!0),a.source(a.onBeforeLoad(u())).then(function(e){e=a.onAfterLoad(e),F=e.content,R("items");var t={number:"page",size:"pageSize",totalElements:"itemCount"};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],o=e[i];Q[n]!==o&&(Q[n]=o,R(n,o))}var l=V();null!==Q.active&&Q.active>=l&&(Q.active=l-1,R("active",Q.active))})["finally"](function(){R("loading",!1)})}function g(){var e=null!==G?G[J]:null;return e?JSON.parse(e):{}}function p(){null!==G&&(G[J]=JSON.stringify({page:Q.page,pageSize:Q.pageSize,orderBy:Q.orderBy}))}function v(){return Q.page}function b(e){var t=i.defer(),n=Math.min(Math.max(0,e),O()-1);return Q.page!==n?(Q.page=n,t.resolve(d())):t.reject(n),t.promise.then(function(e){return H("page",n),e})}function f(){return b(0)}function y(){return b(Q.page-1)}function $(){return b(Q.page+1)}function S(){return b(O()-1)}function h(){return Q.pageSize}function z(e){var t=i.defer(),n=Math.max(1,e);return Q.pageSize!==n?(Q.pageSize=n,t.resolve(d())):t.reject(n),t.promise.then(function(e){return H("pageSize",n),e})}function k(){return Q.orderBy}function w(t,n){var o,a=i.defer();return Q.orderBy?o=e.isUndefined(t)||null===t||null===n?null:Q.orderBy.key!==t?{key:t,asc:e.isUndefined(n)||!!n}:e.isDefined(n)&&Q.orderBy.asc!==n?{key:Q.orderBy.key,asc:n}:Q.orderBy.asc?{key:Q.orderBy.key,asc:!1}:null:e.isDefined(t)&&null!==t&&null!==n&&(o={key:t,asc:e.isUndefined(n)||!!n}),e.isDefined(o)?(Q.orderBy=o,a.resolve(d())):a.reject({key:t,asc:e.isUndefined(n)||!!n}),a.promise.then(function(e){return H("orderBy",o),e})}function B(){return w(null)}function A(){return Q.active}function T(e){var t,n=i.defer(),o=!1,a=!1,l=V();return null===e?t=null!==Q.active?null:Q.active:0>e?(o=Q.page>0,t=o?Q.pageSize-1:null!==e?0:null):e>=l?(a=Q.page<O()-1,t=a?0:null!==e?l-1:null):t=Math.min(e,F.length-1),Q.active!==t?(Q.active=t,o?n.resolve(y()):a?n.resolve($()):n.resolve()):n.reject(t),n.promise.then(function(e){return R("active",t),e})}function C(){return T(0)}function P(){return T(null!==Q.active?Q.active-1:0)}function N(){return T(null!==Q.active?Q.active+1:0)}function x(){return T(V()-1)}function E(){return T(null)}function L(t){return e.isDefined(t)?!!Q.visibility[t]:Q.visibility}function j(t,n){var o=i.defer(),a=e.isDefined(n)?!!n:!Q.visibility[t];if(Q.visibility[t]!==a)Q.visibility[t]=a,o.resolve();else{var l={};l[t]=a,o.reject(l)}return o.promise.then(function(e){return R("visibility",Q.visibility),e})}function U(t){return e.isDefined(t)?!!Q.selection[t]:Q.selection}function M(t,n){var o=i.defer(),a=e.isDefined(n)?!!n:!Q.selection[t];if(Q.selection[t]!==a)Q.selection[t]=a,o.resolve();else{var l={};l[t]=a,o.reject(l)}return o.promise.then(function(e){return R("selection",Q.selection),e})}function D(e){var t=i.defer();return null!==Q.active?M(F[Q.active][a.selection],e):void t.reject(e)}function q(){var e=i.defer();return Q.selection!=={}?(Q.selection={},e.resolve()):e.reject(),e.promise.then(function(e){return R("selection",Q.selection),e})}function O(){return Math.ceil(Q.itemCount/Q.pageSize)}function V(){return Q.page<O()-1?Q.pageSize:Q.itemCount%Q.pageSize}function R(e,i){t.$emit(J+"."+e,i)}function H(e,t){R(e,t),p()}var I=this,J=a.namespace+"."+o,K=a.columns,F=[],G=function(){return"session"===a.storage?sessionStorage:"local"===a.storage?localStorage:null}(),Q=e.extend({active:a.active,page:a.page,pageSize:a.pageSizes[0],itemCount:100,orderBy:a.orderBy,selection:{},visibility:function(){for(var e={},t=0;t<K.length;t++)e[K[t].key]=!K[t].isHidden;return e}()},g());I.getConfig=l,I.getName=r,I.getCols=s,I.getRows=c,I.getItemCount=m,I.reload=d,I.getPage=v,I.setPage=b,I.firstPage=f,I.previousPage=y,I.nextPage=$,I.lastPage=S,I.getPageSize=h,I.setPageSize=z,a.orderBy!==!1&&(I.getOrderBy=k,I.setOrderBy=w,I.clearOrderBy=B),a.active!==!1&&(I.getActive=A,I.setActive=T,I.firstActive=C,I.previousActive=P,I.nextActive=N,I.lastActive=x,I.clearActive=E),I.getVisibility=L,I.setVisibility=j,a.selection!==!1&&(I.getSelection=U,I.setSelection=M,I.clearSelection=q,a.active!==!1&&(I.setActiveSelection=D)),I.reload()}function o(){return{restrict:"E",controller:a,controllerAs:"vm",templateUrl:"msm-table-column-selector/msm-table-column-selector.html",scope:{api:"&"}}}function a(e,t){function i(e,t){t.preventDefault();var i=!n.visibility[e];if(!i)for(var a=Object.keys(n.visibility);!i&&a.length>0;){var l=a.shift();i=l!==e&&n.visibility[l]}return i?o.setVisibility(e):void 0}var n=this,o=t.api(),a=o.getConfig();n.isLoading=!1,n.cols=a.columns,n.visibility=o.getVisibility(),n.select=i;var l=e.$on(o.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(o.getName()+".visibility",function(e,t){n.visibility=t});t.$on("$destroy",l),t.$on("$destroy",r)}function l(){return{restrict:"E",controller:r,controllerAs:"vm",templateUrl:"msm-table-pager/msm-table-pager.html",scope:{api:"&"}}}function r(e,t){var i=this,n=1,o=t.api();o.getConfig();i.isLoading=!1,i.page=o.getPage()+n,i.pageSize=o.getPageSize(),i.itemCount=o.getItemCount(),t.$watch("vm.page",function(e,t){o.setPage(e-n)});var a=e.$on(o.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(o.getName()+".page",function(e,t){i.page=t+n}),r=e.$on(o.getName()+".pageSize",function(e,t){i.pageSize=t}),s=e.$on(o.getName()+".itemCount",function(e,t){i.itemCount=t});t.$on("$destroy",a),t.$on("$destroy",l),t.$on("$destroy",r),t.$on("$destroy",s)}function s(){return{restrict:"E",controller:c,controllerAs:"vm",templateUrl:"msm-table-pagination/msm-table-pagination.html",scope:{api:"&"}}}function c(e,t){var i=this,n=1,o=t.api();o.getConfig();i.isLoading=!1,i.page=o.getPage()+n,i.pageSize=o.getPageSize(),i.itemCount=o.getItemCount(),t.$watch("vm.page",function(e,t){o.setPage(e-n)});var a=e.$on(o.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(o.getName()+".page",function(e,t){i.page=t+n}),r=e.$on(o.getName()+".pageSize",function(e,t){i.pageSize=t}),s=e.$on(o.getName()+".itemCount",function(e,t){i.itemCount=t});t.$on("$destroy",a),t.$on("$destroy",l),t.$on("$destroy",r),t.$on("$destroy",s)}function m(){return{restrict:"E",controller:u,controllerAs:"vm",templateUrl:"msm-table-pagination-size/msm-table-pagination-size.html",scope:{api:"&"}}}function u(e,t){function i(e,t){t.preventDefault(),o.setPageSize(e)}var n=this,o=t.api(),a=o.getConfig();n.isLoading=!1,n.pageSize=o.getPageSize(),n.pageSizes=a.pageSizes,n.select=i;var l=e.$on(o.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(o.getName()+".pageSize",function(e,t){n.pageSize=t});t.$on("$destroy",l),t.$on("$destroy",r)}function d(){return{restrict:"E",controller:g,controllerAs:"vm",templateUrl:"msm-table-view/msm-table-view.html",scope:{api:"&"}}}function g(e,t,i,n,o){function a(e,t){return i("filter")(e,function(e){return t[e.key]})}function l(e){return m.onAction(s.rows[c.getActive()],e)}function r(e,t){return function(i){t&&null===c.getActive()||(i.preventDefault(),e())}}var s=this,c=t.api(),m=c.getConfig();s.isLoading=!1,s.name=c.getName(),s.cols=a(m.columns,c.getVisibility()),s.rows=c.getRows(),s.orderByEnabled=m.orderBy!==!1,s.orderByEnabled&&(s.orderBy=c.getOrderBy(),s.setOrderBy=c.setOrderBy),s.activeEnabled=m.active!==!1,s.activeEnabled&&(s.active=c.getActive(),s.setActive=c.setActive,s.clearActive=c.clearActive),s.selectionEnabled=m.selection!==!1,s.selectionEnabled&&(s.selectionKey=m.selection,s.selection=c.getSelection(),s.setSelection=c.setSelection,s.clearSelection=c.clearSelection),s.isMobile=!1,s.mobileSize=m.mobileSize,s.mobileTemplateUrl=m.mobileTemplateUrl,s.mobileSize&&s.mobileTemplateUrl&&(s.isMobile=o.is(s.mobileSize),o.on(s.mobileSize,function(e){s.isMobile!==e&&(s.isMobile=e)})),n.bindTo(t).add({combo:"shift+left",callback:r(c.firstPage)}).add({combo:"left",callback:r(c.previousPage)}).add({combo:"right",callback:r(c.nextPage)}).add({combo:"shift+right",callback:r(c.lastPage)}),s.activeEnabled&&n.bindTo(t).add({combo:"shift+up",callback:r(c.firstActive)}).add({combo:"up",callback:r(c.previousActive,!0)}).add({combo:"down",callback:r(c.nextActive,!0)}).add({combo:"shift+down",callback:r(c.lastActive)}).add({combo:"esc",callback:c.clearActive}).add({combo:"return",callback:r(l,!0)}),s.selectionEnabled&&n.bindTo(t).add({combo:"shift+esc",callback:c.clearSelection}),s.activeEnabled&&s.selectionEnabled&&n.bindTo(t).add({combo:"space",callback:r(c.setActiveSelection)});var u=e.$on(c.getName()+".loading",function(e,t){s.isLoading=t}),d=e.$on(c.getName()+".items",function(e){s.rows=c.getRows()}),g=e.$on(c.getName()+".orderBy",function(e,t){s.orderBy=t}),p=e.$on(c.getName()+".active",function(e,t){s.active=t}),v=e.$on(c.getName()+".visibility",function(e,t){s.cols=a(m.columns,t)}),b=e.$on(c.getName()+".selection",function(e,t){s.selection=t});t.$on("$destroy",u),t.$on("$destroy",d),t.$on("$destroy",g),t.$on("$destroy",p),t.$on("$destroy",v),t.$on("$destroy",b)}function p(t,i){return{restrict:"A",require:"^msmTableView",scope:!1,link:function(n,o,a){var l=n.col.templateUrl,r=n.col.template;e.isDefined(l)?i(l).then(function(e){o[0].innerHTML=e,t(o.contents())(n)}):e.isDefined(r)&&(o[0].innerHTML=r,t(o.contents())(n))}}}t.$inject=["msmTableConfig","$translateProvider"],a.$inject=["$rootScope","$scope"],r.$inject=["$rootScope","$scope"],c.$inject=["$rootScope","$scope"],u.$inject=["$rootScope","$scope"],g.$inject=["$rootScope","$scope","$filter","hotkeys","screenSize"],p.$inject=["$compile","$templateRequest"],e.module("mindsmash-table",["ui.bootstrap.dropdown","ui.bootstrap.pager","ui.bootstrap.pagination","ui.bootstrap.tpls","angular-click-outside","cfp.hotkeys","matchMedia","pascalprecht.translate"]),e.module("mindsmash-table").run(["$templateCache",function(e){e.put("msm-table-column-selector/msm-table-column-selector.html",'<div class="btn-group" uib-dropdown auto-close="outsideClick"><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading"><span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="col in vm.cols" role="menuitem" ng-class="{ \'disabled\': col.isSticky, \'msm-table-isSelected\': vm.visibility[col.key] }"><a href="#" ng-click="!col.isSticky && vm.select(col.key, $event)" translate="{{ col.name }}"></a></li></ul></div>'),e.put("msm-table-pager/msm-table-pager.html",'<uib-pager ng-model="vm.page" total-items="vm.itemCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pager.previous\' | translate }}" next-text="{{ \'msmTable.pager.next\' | translate }}"></uib-pager>'),e.put("msm-table-pagination/msm-table-pagination.html",'<uib-pagination ng-model="vm.page" total-items="vm.itemCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pagination.previous\' | translate }}" next-text="{{ \'msmTable.pagination.next\' | translate }}" rotate="true" max-size="5"></uib-pagination>'),e.put("msm-table-pagination-size/msm-table-pagination-size.html",'<div class="btn-group" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading">{{ vm.pageSize }} <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="pageSize in vm.pageSizes" role="menuitem" ng-class="{ \'msm-table-isSelected\': pageSize === vm.pageSize }"><a href="#" ng-click="vm.select(pageSize, $event)">{{ pageSize }}</a></li></ul></div>'),e.put("msm-table-view/msm-table-view.html",'<div><table id="{{ vm.name }}" class="table msm-table-table-view" ng-if="!vm.isMobile" click-outside="vm.clearActive()"><thead><tr><th class="msm-table-selector-all" ng-show="vm.selectionEnabled"></th><th ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" ng-class="{\'msm-table-isSortable\': vm.orderByEnabled && col.isSortable !== false,\'msm-table-isSortedAsc\': vm.orderBy.key === col.key && vm.orderBy.asc === true,\'msm-table-isSortedDesc\': vm.orderBy.key === col.key && vm.orderBy.asc === false }" ng-click="vm.orderByEnabled && col.isSortable !== false && vm.setOrderBy(col.key)" translate="{{ col.name }}"></th></tr></thead><tbody><tr ng-repeat="row in vm.rows" ng-class="{ \'msm-table-isActive\': vm.active === $index, \'msm-table-isSelected\': vm.selection[row.id] }" ng-click="vm.activeEnabled && vm.setActive($index)"><td class="msm-table-selector" ng-show="vm.selectionEnabled" ng-click="vm.setSelection(row[vm.selectionKey])"></td><td ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" data-label="{{ col.name }}" msm-table-view-cell>{{ row[col.key] }}</td></tr></tbody></table><ol class="list-unstyled msm-table-list-view" ng-if="vm.isMobile"><li ng-repeat="row in vm.rows" ng-include="vm.mobileTemplateUrl"></li></ol></div>')}]),e.module("mindsmash-table").provider("msmTableFactory",t),e.module("mindsmash-table").directive("msmTableColumnSelector",o),e.module("mindsmash-table").constant("msmTableConfig",{namespace:"msmTable",source:e.noop,columns:[],onAction:e.noop,onBeforeLoad:e.identity,onAfterLoad:e.identity,page:0,pageSizes:[10,25,50,100],orderBy:null,active:null,selection:"id",storage:"session",mobileSize:"xs",mobileTemplateUrl:null}),e.module("mindsmash-table").directive("msmTablePager",l),e.module("mindsmash-table").directive("msmTablePagination",s),e.module("mindsmash-table").directive("msmTablePaginationSize",m),e.module("mindsmash-table").directive("msmTableView",d),e.module("mindsmash-table").directive("msmTableViewCell",p)}(angular);
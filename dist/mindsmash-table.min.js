/**
 * @name mindsmash-table
 * @version v0.1.1
 * @author mindsmash GmbH
 * @license MIT
 */
!function(e){"use strict";function t(t,i){function a(t){e.merge(r,t)}function o(e,t,i){return new n(e,t,i,r)}o.$inject=["$rootScope","$q","$window"];var r=t;return i.translations("en",{"msmTable.pagination.previous":"«","msmTable.pagination.next":"»","msmTable.pager.previous":"« Previous","msmTable.pager.next":"Next »"}),{setTableConfig:a,$get:o}}function n(t,n,a,o){function r(r,l){return new i(t,n,a,r,e.merge(o,l))}return{get:r}}function i(t,n,i,a,o){function r(){return o}function l(){return J}function s(){return F}function c(){return F}function m(){return Q.itemCount}function u(){var e={page:Q.page,pageSize:Q.pageSize};return Q.orderBy&&(e.orderBy=Q.orderBy.key,e.orderAsc=Q.orderBy.asc),e}function d(){return R("loading",!0),o.source(o.onBeforeLoad(u())).then(function(e){e=o.onAfterLoad(e),F=e.content,R("items");var t={number:"page",size:"pageSize",totalElements:"itemCount"};for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],a=e[n];Q[i]!==a&&(Q[i]=a,R(i,a))}var r=V();null!==Q.active&&Q.active>=r&&(Q.active=r-1,R("active",Q.active))})["finally"](function(){R("loading",!1)})}function g(){var e=null!==G?G[J]:null;return e?JSON.parse(e):{}}function p(){null!==G&&(G[J]=JSON.stringify({page:Q.page,pageSize:Q.pageSize,orderBy:Q.orderBy}))}function v(){return Q.page}function b(e){var t=n.defer(),i=Math.min(Math.max(0,e),M()-1);return Q.page!==i?(Q.page=i,t.resolve(d())):t.reject(i),t.promise.then(function(e){return H("page",i),e})}function f(){return b(0)}function y(){return b(Q.page-1)}function $(){return b(Q.page+1)}function S(){return b(M()-1)}function h(){return Q.pageSize}function z(e){var t=n.defer(),i=Math.max(1,e);return Q.pageSize!==i?(Q.pageSize=i,t.resolve(d())):t.reject(i),t.promise.then(function(e){return H("pageSize",i),e})}function k(){return Q.orderBy}function w(t,i){var a,o=n.defer();return Q.orderBy?a=e.isUndefined(t)||null===t||null===i?null:Q.orderBy.key!==t?{key:t,asc:e.isUndefined(i)||!!i}:e.isDefined(i)&&Q.orderBy.asc!==i?{key:Q.orderBy.key,asc:i}:Q.orderBy.asc?{key:Q.orderBy.key,asc:!1}:null:e.isDefined(t)&&null!==t&&null!==i&&(a={key:t,asc:e.isUndefined(i)||!!i}),e.isDefined(a)?(Q.orderBy=a,o.resolve(d())):o.reject({key:t,asc:e.isUndefined(i)||!!i}),o.promise.then(function(e){return H("orderBy",a),e})}function B(){return w(null)}function A(){return Q.active}function C(e){var t,i=n.defer(),a=!1,o=!1,r=V();return null===e?t=null!==Q.active?null:Q.active:0>e?(a=Q.page>0,t=a?Q.pageSize-1:null!==e?0:null):e>=r?(o=Q.page<M()-1,t=o?0:null!==e?r-1:null):t=Math.min(e,F.length-1),Q.active!==t?(Q.active=t,a?i.resolve(y()):o?i.resolve($()):i.resolve()):i.reject(t),i.promise.then(function(e){return R("active",t),e})}function P(){return C(0)}function T(){return C(null!==Q.active?Q.active-1:0)}function N(){return C(null!==Q.active?Q.active+1:0)}function x(){return C(V()-1)}function E(){return C(null)}function L(t){return e.isDefined(t)?!!Q.visibility[t]:Q.visibility}function j(t,i){var a=n.defer(),o=e.isDefined(i)?!!i:!Q.visibility[t];if(Q.visibility[t]!==o)Q.visibility[t]=o,a.resolve();else{var r={};r[t]=o,a.reject(r)}return a.promise.then(function(e){return R("visibility",Q.visibility),e})}function D(t){return e.isDefined(t)?!!Q.selection[t]:Q.selection}function q(t,i){var a=n.defer(),o=e.isDefined(i)?!!i:!Q.selection[t];if(Q.selection[t]!==o)Q.selection[t]=o,a.resolve();else{var r={};r[t]=o,a.reject(r)}return a.promise.then(function(e){return R("selection",Q.selection),e})}function O(e){var t=n.defer();return null!==Q.active?q(F[Q.active][o.selection],e):void t.reject(e)}function U(){var e=n.defer();return Q.selection!=={}?(Q.selection={},e.resolve()):e.reject(),e.promise.then(function(e){return R("selection",Q.selection),e})}function M(){return Math.ceil(Q.itemCount/Q.pageSize)}function V(){return Q.page<M()-1?Q.pageSize:Q.itemCount%Q.pageSize}function R(e,n){t.$emit(J+"."+e,n)}function H(e,t){R(e,t),p()}var I=this,J=o.namespace+"."+a,K=o.columns,F=[],G=function(){return"session"===o.storage?sessionStorage:"local"===o.storage?localStorage:null}(),Q=e.extend({active:o.active,page:o.page,pageSize:o.pageSizes[0],itemCount:100,orderBy:o.orderBy,selection:{},visibility:function(){for(var e={},t=0;t<K.length;t++)e[K[t].key]=!K[t].isHidden;return e}()},g());I.getConfig=r,I.getName=l,I.getCols=s,I.getRows=c,I.getItemCount=m,I.reload=d,I.getPage=v,I.setPage=b,I.firstPage=f,I.previousPage=y,I.nextPage=$,I.lastPage=S,I.getPageSize=h,I.setPageSize=z,o.orderBy!==!1&&(I.getOrderBy=k,I.setOrderBy=w,I.clearOrderBy=B),o.active!==!1&&(I.getActive=A,I.setActive=C,I.firstActive=P,I.previousActive=T,I.nextActive=N,I.lastActive=x,I.clearActive=E),I.getVisibility=L,I.setVisibility=j,o.selection!==!1&&(I.getSelection=D,I.setSelection=q,I.clearSelection=U,o.active!==!1&&(I.setActiveSelection=O)),I.reload()}function a(){return{restrict:"E",controller:o,controllerAs:"vm",templateUrl:"msm-table-column-selector/msm-table-column-selector.html",scope:{api:"&"}}}function o(e,t){function n(e,t){t.preventDefault();var n=!i.visibility[e];if(!n)for(var o=Object.keys(i.visibility);!n&&o.length>0;){var r=o.shift();n=r!==e&&i.visibility[r]}return n?a.setVisibility(e):void 0}var i=this,a=t.api(),o=a.getConfig();i.isLoading=!1,i.cols=o.columns,i.visibility=a.getVisibility(),i.select=n;var r=e.$on(a.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(a.getName()+".visibility",function(e,t){i.visibility=t});t.$on("$destroy",r),t.$on("$destroy",l)}function r(){return{restrict:"E",controller:l,controllerAs:"vm",templateUrl:"msm-table-pager/msm-table-pager.html",scope:{api:"&"}}}function l(e,t){var n=this,i=1,a=t.api();a.getConfig();n.isLoading=!1,n.page=a.getPage()+i,n.pageSize=a.getPageSize(),n.itemCount=a.getItemCount(),t.$watch("vm.page",function(e,t){a.setPage(e-i)});var o=e.$on(a.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(a.getName()+".page",function(e,t){n.page=t+i}),l=e.$on(a.getName()+".pageSize",function(e,t){n.pageSize=t}),s=e.$on(a.getName()+".itemCount",function(e,t){n.itemCount=t});t.$on("$destroy",o),t.$on("$destroy",r),t.$on("$destroy",l),t.$on("$destroy",s)}function s(){return{restrict:"E",controller:c,controllerAs:"vm",templateUrl:"msm-table-pagination/msm-table-pagination.html",scope:{api:"&"}}}function c(e,t){var n=this,i=1,a=t.api();a.getConfig();n.isLoading=!1,n.page=a.getPage()+i,n.pageSize=a.getPageSize(),n.itemCount=a.getItemCount(),t.$watch("vm.page",function(e,t){a.setPage(e-i)});var o=e.$on(a.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(a.getName()+".page",function(e,t){n.page=t+i}),l=e.$on(a.getName()+".pageSize",function(e,t){n.pageSize=t}),s=e.$on(a.getName()+".itemCount",function(e,t){n.itemCount=t});t.$on("$destroy",o),t.$on("$destroy",r),t.$on("$destroy",l),t.$on("$destroy",s)}function m(){return{restrict:"E",controller:u,controllerAs:"vm",templateUrl:"msm-table-pagination-size/msm-table-pagination-size.html",scope:{api:"&"}}}function u(e,t){function n(e,t){t.preventDefault(),a.setPageSize(e)}var i=this,a=t.api(),o=a.getConfig();i.isLoading=!1,i.pageSize=a.getPageSize(),i.pageSizes=o.pageSizes,i.select=n;var r=e.$on(a.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(a.getName()+".pageSize",function(e,t){i.pageSize=t});t.$on("$destroy",r),t.$on("$destroy",l)}function d(){return{restrict:"E",controller:g,controllerAs:"vm",templateUrl:"msm-table-view/msm-table-view.html",scope:{api:"&"}}}function g(e,t,n,i){function a(e,t){return n("filter")(e,function(e){return t[e.key]})}function o(e){return c.onAction(l.rows[s.getActive()],e)}function r(e,t){return function(n){t&&null===s.getActive()||(n.preventDefault(),e())}}var l=this,s=t.api(),c=s.getConfig();l.isLoading=!1,l.name=s.getName(),l.cols=a(c.columns,s.getVisibility()),l.rows=s.getRows(),l.orderByEnabled=c.orderBy!==!1,l.orderByEnabled&&(l.orderBy=s.getOrderBy(),l.setOrderBy=s.setOrderBy),l.activeEnabled=c.active!==!1,l.activeEnabled&&(l.active=s.getActive(),l.setActive=s.setActive,l.clearActive=s.clearActive),l.selectionEnabled=c.selection!==!1,l.selectionEnabled&&(l.selectionKey=c.selection,l.selection=s.getSelection(),l.setSelection=s.setSelection,l.clearSelection=s.clearSelection),i.bindTo(t).add({combo:"shift+left",callback:r(s.firstPage)}).add({combo:"left",callback:r(s.previousPage)}).add({combo:"right",callback:r(s.nextPage)}).add({combo:"shift+right",callback:r(s.lastPage)}),l.activeEnabled&&i.bindTo(t).add({combo:"shift+up",callback:r(s.firstActive)}).add({combo:"up",callback:r(s.previousActive,!0)}).add({combo:"down",callback:r(s.nextActive,!0)}).add({combo:"shift+down",callback:r(s.lastActive)}).add({combo:"esc",callback:s.clearActive}).add({combo:"return",callback:r(o,!0)}),l.selectionEnabled&&i.bindTo(t).add({combo:"shift+esc",callback:s.clearSelection}),l.activeEnabled&&l.selectionEnabled&&i.bindTo(t).add({combo:"space",callback:r(s.setActiveSelection)});var m=e.$on(s.getName()+".loading",function(e,t){l.isLoading=t}),u=e.$on(s.getName()+".items",function(e){l.rows=s.getRows()}),d=e.$on(s.getName()+".orderBy",function(e,t){l.orderBy=t}),g=e.$on(s.getName()+".active",function(e,t){l.active=t}),p=e.$on(s.getName()+".visibility",function(e,t){l.cols=a(c.columns,t)}),v=e.$on(s.getName()+".selection",function(e,t){l.selection=t});t.$on("$destroy",m),t.$on("$destroy",u),t.$on("$destroy",d),t.$on("$destroy",g),t.$on("$destroy",p),t.$on("$destroy",v)}function p(t,n){return{restrict:"A",require:"^msmTableView",scope:!1,link:function(i,a,o){var r=i.col.templateUrl,l=i.col.template;e.isDefined(r)?n(r).then(function(e){a[0].innerHTML=e,t(a.contents())(i)}):e.isDefined(l)&&(a[0].innerHTML=l,t(a.contents())(i))}}}t.$inject=["msmTableConfig","$translateProvider"],o.$inject=["$rootScope","$scope"],l.$inject=["$rootScope","$scope"],c.$inject=["$rootScope","$scope"],u.$inject=["$rootScope","$scope"],g.$inject=["$rootScope","$scope","$filter","hotkeys"],p.$inject=["$compile","$templateRequest"],function(e){e.module("mindsmash-table",["ui.bootstrap.dropdown","ui.bootstrap.pager","ui.bootstrap.pagination","ui.bootstrap.tpls","angular-click-outside","cfp.hotkeys","matchMedia","pascalprecht.translate"])}(e),e.module("mindsmash-table").run(["$templateCache",function(e){e.put("msm-table-column-selector/msm-table-column-selector.html",'<div class="btn-group" uib-dropdown auto-close="outsideClick"> <button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading"> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="caret"></span> </button> <ul uib-dropdown-menu role="menu"> <li ng-repeat="col in vm.cols" role="menuitem" ng-class="{ \'disabled\': col.isSticky, \'msm-table-isSelected\': vm.visibility[col.key] }"> <a href="#" ng-click="!col.isSticky && vm.select(col.key, $event)" translate="{{ col.name }}"></a> </li> </ul> </div>'),e.put("msm-table-pager/msm-table-pager.html",'<uib-pager ng-model="vm.page" total-items="vm.itemCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pager.previous\' | translate }}" next-text="{{ \'msmTable.pager.next\' | translate }}"></uib-pager>'),e.put("msm-table-pagination/msm-table-pagination.html",'<uib-pagination ng-model="vm.page" total-items="vm.itemCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pagination.previous\' | translate }}" next-text="{{ \'msmTable.pagination.next\' | translate }}" rotate="true" max-size="5"></uib-pagination>'),e.put("msm-table-pagination-size/msm-table-pagination-size.html",'<div class="btn-group" uib-dropdown> <button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading"> {{ vm.pageSize }} <span class="caret"></span> </button> <ul uib-dropdown-menu role="menu"> <li ng-repeat="pageSize in vm.pageSizes" role="menuitem" ng-class="{ \'msm-table-isSelected\': pageSize === vm.pageSize }"> <a href="#" ng-click="vm.select(pageSize, $event)">{{ pageSize }}</a> </li> </ul> </div>'),e.put("msm-table-view/msm-table-view.html",'<div> <table class="table msm-table-table-view" id="{{ vm.name }}" click-outside="vm.clearActive()"> <thead> <tr> <th class="msm-table-selector-all" ng-show="vm.selectionEnabled"></th> <th ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" ng-class="{\n              \'msm-table-isSortable\': vm.orderByEnabled,\n              \'msm-table-isSortedAsc\': vm.orderBy.key === col.key && vm.orderBy.asc === true,\n              \'msm-table-isSortedDesc\': vm.orderBy.key === col.key && vm.orderBy.asc === false }" ng-click="vm.orderByEnabled && vm.setOrderBy(col.key)" translate="{{ col.name }}"> </th> </tr> </thead> <tbody> <tr ng-repeat="row in vm.rows" ng-class="{ \'msm-table-isActive\': vm.active === $index, \'msm-table-isSelected\': vm.selection[row.id] }" ng-click="vm.activeEnabled && vm.setActive($index)"> <td class="msm-table-selector" ng-show="vm.selectionEnabled" ng-click="vm.setSelection(row[vm.selectionKey])"></td> <td ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" data-label="{{ col.name }}" msm-table-view-cell>{{ row[col.key] }} </td> </tr> </tbody> </table> <ol class="list-unstyled msm-table-list-view"> <li ng-repeat="row in vm.rows" ng-include="\'templates/row.mobile.html\'"></li> </ol> </div>')}]),e.module("mindsmash-table").provider("msmTableFactory",t),e.module("mindsmash-table").directive("msmTableColumnSelector",a),e.module("mindsmash-table").constant("msmTableConfig",{namespace:"msmTable",source:e.noop,columns:[],active:null,page:0,pageSizes:[10,25,50,100],onAction:e.noop,onBeforeLoad:e.identity,onAfterLoad:e.identity,selection:"id",orderBy:null,storage:"session"}),e.module("mindsmash-table").directive("msmTablePager",r),e.module("mindsmash-table").directive("msmTablePagination",s),e.module("mindsmash-table").directive("msmTablePaginationSize",m),e.module("mindsmash-table").directive("msmTableView",d),e.module("mindsmash-table").directive("msmTableViewCell",p)}(angular);
/**
 * @name mindsmash-table
 * @version v0.3.0
 * @author mindsmash GmbH
 * @license MIT
 */
!function(e){"use strict";function t(){return{restrict:"E",controller:i,controllerAs:"vm",templateUrl:"msm-table-column-selector/msm-table-column-selector.html",scope:{api:"&"}}}function i(e,t){function i(e,t){t.preventDefault();var i=!n.visibility[e];if(!i)for(var o=Object.keys(n.visibility);!i&&o.length>0;){var r=o.shift();i=r!==e&&n.visibility[r]}return i?a.setVisibility(e):void 0}var n=this,a=t.api(),o=a.getConfig();n.isLoading=!1,n.cols=o.columns,n.visibility=a.getVisibility(),n.select=i;var r=e.$on(a.getName()+".loading",function(e,t){n.isLoading=t}),l=e.$on(a.getName()+".visibility",function(e,t){n.visibility=t});t.$on("$destroy",r),t.$on("$destroy",l)}function n(t,i){function n(t){e.merge(r,t)}function o(e,t,i,n){return new a(e,t,i,n,r)}o.$inject=["$rootScope","$filter","$q","$window"];var r=t;return i.translations("en",{"msmTable.pagination.previous":"«","msmTable.pagination.next":"»","msmTable.pager.previous":"« Previous","msmTable.pager.next":"Next »"}),{setTableConfig:n,$get:o}}function a(t,i,n,a,r){function l(l,s){return new o(t,i,n,a,l,e.merge(r,s))}return{get:l}}function o(t,i,n,a,o,r){function l(){return r}function s(){return G}function c(){return Q}function m(){return Q}function u(){return X.rowCount}function d(){var e={page:X.page,pageSize:X.pageSize};return X.orderBy&&(e.orderBy=X.orderBy.key,e.orderAsc=X.orderBy.asc),e}function g(e){var t=r.source;return n(function(n){var a=e.page*e.pageSize,o=a+e.pageSize,r=e.orderBy?i("orderBy")(t,e.orderBy,!e.orderAsc):t;r=r.slice(a,o),n({content:r,number:e.page,numberOfElements:r.length,size:e.pageSize,sort:e.orderBy,totalElements:t.length,totalPages:Math.ceil(t.length/e.pageSize)})})}function p(){var t=r.onBeforeLoad(d()),i=e.isArray(r.source)?g(t):r.source(t);return J("loading",!0),i.then(function(e){e=r.onAfterLoad(e),Q=e.content,J("items");var t={number:"page",size:"pageSize",totalElements:"rowCount",orderBy:"orderBy"};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],a=e[i];X[n]!==a&&(X[n]=a,J(n,a))}var o=H();null!==X.active&&X.active>=o&&(X.active=o-1,J("active",X.active))})["finally"](function(){J("loading",!1)})}function v(){var e=null!==W?W[G]:null;return e?JSON.parse(e):{}}function b(){null!==W&&(W[G]=JSON.stringify({page:X.page,pageSize:X.pageSize,orderBy:X.orderBy}))}function f(){return X.page}function y(e){var t=n.defer(),i=Math.min(Math.max(0,e),R()-1);return X.page!==i?(X.page=i,t.resolve(p())):t.reject(i),t.promise.then(function(e){return K("page",i),e})}function $(){return y(0)}function S(){return y(X.page-1)}function h(){return y(X.page+1)}function z(){return y(R()-1)}function w(){return X.pageSize}function k(e){var t=n.defer(),i=Math.max(1,e);return X.pageSize!==i?(X.pageSize=i,t.resolve(p())):t.reject(i),t.promise.then(function(e){return K("pageSize",i),e})}function B(){return X.orderBy}function A(t,i){var a,o=n.defer();return X.orderBy?a=e.isUndefined(t)||null===t||null===i?null:X.orderBy.key!==t?{key:t,asc:e.isUndefined(i)||!!i}:e.isDefined(i)&&X.orderBy.asc!==i?{key:X.orderBy.key,asc:i}:X.orderBy.asc?{key:X.orderBy.key,asc:!1}:null:e.isDefined(t)&&null!==t&&null!==i&&(a={key:t,asc:e.isUndefined(i)||!!i}),e.isDefined(a)?(X.orderBy=a,o.resolve(p())):o.reject({key:t,asc:e.isUndefined(i)||!!i}),o.promise.then(function(e){return K("orderBy",a),e})}function T(){return A(null)}function C(){return X.active}function P(e){var t,i=n.defer(),a=!1,o=!1,r=H();return null===e?t=null!==X.active?null:X.active:0>e?(a=X.page>0,t=a?X.pageSize-1:null!==e?0:null):e>=r?(o=X.page<R()-1,t=o?0:null!==e?r-1:null):t=Math.min(e,Q.length-1),X.active!==t?(X.active=t,a?i.resolve(S()):o?i.resolve(h()):i.resolve()):i.reject(t),i.promise.then(function(e){return J("active",t),e})}function E(){return P(0)}function L(){return P(null!==X.active?X.active-1:0)}function N(){return P(null!==X.active?X.active+1:0)}function x(){return P(H()-1)}function j(){return P(null)}function M(t){return e.isDefined(t)?!!X.visibility[t]:X.visibility}function U(t,i){var a=n.defer(),o=e.isDefined(i)?!!i:!X.visibility[t];if(X.visibility[t]!==o)X.visibility[t]=o,a.resolve();else{var r={};r[t]=o,a.reject(r)}return a.promise.then(function(e){return J("visibility",X.visibility),e})}function D(t){return e.isDefined(t)?!!X.selection[t]:X.selection}function q(t,i){var a=n.defer(),o=e.isDefined(i)?!!i:!X.selection[t];if(X.selection[t]!==o)X.selection[t]=o,a.resolve();else{var r={};r[t]=o,a.reject(r)}return a.promise.then(function(e){return J("selection",X.selection),e})}function O(e){var t=n.defer();return null!==X.active?q(Q[X.active][r.selection],e):void t.reject(e)}function V(){var e=n.defer();return X.selection!=={}?(X.selection={},e.resolve()):e.reject(),e.promise.then(function(e){return J("selection",X.selection),e})}function R(){return Math.ceil(X.rowCount/X.pageSize)}function H(){return X.page<R()-1?X.pageSize:X.rowCount%X.pageSize}function J(e,i){t.$emit(G+"."+e,i)}function K(e,t){J(e,t),b()}var F=this,G=r.namespace+"."+o,I=r.columns,Q=[],W=function(){return"session"===r.storage?sessionStorage:"local"===r.storage?localStorage:null}(),X=e.extend({page:r.page,pageSize:r.pageSizes[0],rowCount:100,orderBy:r.orderBy,active:r.active,selection:{},visibility:function(){for(var e={},t=0;t<I.length;t++)e[I[t].key]=!I[t].isHidden;return e}()},v());F.getConfig=l,F.getName=s,F.getCols=c,F.getRows=m,F.getRowCount=u,F.reload=p,F.getPage=f,F.setPage=y,F.firstPage=$,F.previousPage=S,F.nextPage=h,F.lastPage=z,F.getPageSize=w,F.setPageSize=k,r.orderBy!==!1&&(F.getOrderBy=B,F.setOrderBy=A,F.clearOrderBy=T),r.active!==!1&&(F.getActive=C,F.setActive=P,F.firstActive=E,F.previousActive=L,F.nextActive=N,F.lastActive=x,F.clearActive=j),F.getVisibility=M,F.setVisibility=U,r.selection!==!1&&(F.getSelection=D,F.setSelection=q,F.clearSelection=V,r.active!==!1&&(F.setActiveSelection=O)),F.reload()}function r(){return{restrict:"E",controller:l,controllerAs:"vm",templateUrl:"msm-table-pager/msm-table-pager.html",scope:{api:"&"}}}function l(e,t){var i=this,n=1,a=t.api();a.getConfig();i.isLoading=!1,i.page=a.getPage()+n,i.pageSize=a.getPageSize(),i.rowCount=a.getRowCount(),t.$watch("vm.page",function(e,t){a.setPage(e-n)});var o=e.$on(a.getName()+".loading",function(e,t){i.isLoading=t}),r=e.$on(a.getName()+".page",function(e,t){i.page=t+n}),l=e.$on(a.getName()+".pageSize",function(e,t){i.pageSize=t}),s=e.$on(a.getName()+".rowCount",function(e,t){i.rowCount=t});t.$on("$destroy",o),t.$on("$destroy",r),t.$on("$destroy",l),t.$on("$destroy",s)}function s(){return{restrict:"E",controller:c,controllerAs:"vm",templateUrl:"msm-table-pagination/msm-table-pagination.html",scope:{api:"&"}}}function c(e,t){var i=this,n=1,a=t.api();a.getConfig();i.isLoading=!1,i.page=a.getPage()+n,i.pageSize=a.getPageSize(),i.rowCount=a.getRowCount(),t.$watch("vm.page",function(e,t){a.setPage(e-n)});var o=e.$on(a.getName()+".loading",function(e,t){i.isLoading=t}),r=e.$on(a.getName()+".page",function(e,t){i.page=t+n}),l=e.$on(a.getName()+".pageSize",function(e,t){i.pageSize=t}),s=e.$on(a.getName()+".rowCount",function(e,t){i.rowCount=t});t.$on("$destroy",o),t.$on("$destroy",r),t.$on("$destroy",l),t.$on("$destroy",s)}function m(){return{restrict:"E",controller:u,controllerAs:"vm",templateUrl:"msm-table-pagination-size/msm-table-pagination-size.html",scope:{api:"&"}}}function u(e,t){function i(e,t){t.preventDefault(),n.pageSize=e,a.setPageSize(e)}var n=this,a=t.api(),o=a.getConfig();n.isLoading=!1,n.pageSize=a.getPageSize(),n.pageSizes=o.pageSizes,n.select=i;var r=e.$on(a.getName()+".loading",function(e,t){n.isLoading=t}),l=e.$on(a.getName()+".pageSize",function(e,t){n.pageSize=t});t.$on("$destroy",r),t.$on("$destroy",l)}function d(){return{restrict:"E",controller:g,controllerAs:"vm",templateUrl:"msm-table-view/msm-table-view.html",scope:{api:"&"}}}function g(e,t,i,n,a){function o(e,t){return i("filter")(e,function(e){return t[e.key]})}function r(){return null===m.active?u.lastActive():u.firstActive()}function l(){return null===m.active?u.firstActive():u.lastActive()}function s(e){return d.onAction(m.rows[u.getActive()],e)}function c(e,t){return function(i){m.isLoading||t&&null===u.getActive()||(i.preventDefault(),e())}}var m=this,u=t.api(),d=u.getConfig();m.isLoading=!1,m.name=u.getName(),m.cols=o(d.columns,u.getVisibility()),m.rows=u.getRows(),m.orderByEnabled=d.orderBy!==!1,m.orderByEnabled&&(m.orderBy=u.getOrderBy(),m.setOrderBy=u.setOrderBy),m.activeEnabled=d.active!==!1,m.activeEnabled&&(m.active=u.getActive(),m.setActive=u.setActive,m.clearActive=u.clearActive),m.selectionEnabled=d.selection!==!1,m.selectionEnabled&&(m.selectionKey=d.selection,m.selection=u.getSelection(),m.setSelection=u.setSelection,m.clearSelection=u.clearSelection),m.isMobile=!1,m.mobileSize=d.mobileSize,m.mobileTemplateUrl=d.mobileTemplateUrl,m.mobileSize&&m.mobileTemplateUrl&&(m.isMobile=a.is(m.mobileSize),a.on(m.mobileSize,function(e){m.isMobile!==e&&(m.isMobile=e)})),n.bindTo(t).add({combo:"shift+left",callback:c(u.firstPage)}).add({combo:"left",callback:c(u.previousPage)}).add({combo:"right",callback:c(u.nextPage)}).add({combo:"shift+right",callback:c(u.lastPage)}),m.activeEnabled&&n.bindTo(t).add({combo:"shift+up",callback:c(r)}).add({combo:"up",callback:c(u.previousActive,!0)}).add({combo:"down",callback:c(u.nextActive,!0)}).add({combo:"shift+down",callback:c(l)}).add({combo:"esc",callback:u.clearActive}).add({combo:"return",callback:c(s,!0)}),m.selectionEnabled&&n.bindTo(t).add({combo:"shift+esc",callback:u.clearSelection}),m.activeEnabled&&m.selectionEnabled&&n.bindTo(t).add({combo:"space",callback:c(u.setActiveSelection)});var g=e.$on(u.getName()+".loading",function(e,t){m.isLoading=t}),p=e.$on(u.getName()+".items",function(e){m.rows=u.getRows()}),v=e.$on(u.getName()+".orderBy",function(e,t){m.orderBy=t}),b=e.$on(u.getName()+".active",function(e,t){m.active=t}),f=e.$on(u.getName()+".visibility",function(e,t){m.cols=o(d.columns,t)}),y=e.$on(u.getName()+".selection",function(e,t){m.selection=t});t.$on("$destroy",g),t.$on("$destroy",p),t.$on("$destroy",v),t.$on("$destroy",b),t.$on("$destroy",f),t.$on("$destroy",y)}function p(t,i){return{restrict:"A",require:"^msmTableView",scope:!1,link:function(n,a,o){var r=n.col.templateUrl,l=n.col.template;e.isDefined(r)?i(r).then(function(e){a[0].innerHTML=e,t(a.contents())(n)}):e.isDefined(l)&&(a[0].innerHTML=l,t(a.contents())(n))}}}i.$inject=["$rootScope","$scope"],n.$inject=["msmTableConfig","$translateProvider"],l.$inject=["$rootScope","$scope"],c.$inject=["$rootScope","$scope"],u.$inject=["$rootScope","$scope"],g.$inject=["$rootScope","$scope","$filter","hotkeys","screenSize"],p.$inject=["$compile","$templateRequest"],e.module("mindsmash-table",["ui.bootstrap.dropdown","ui.bootstrap.pager","ui.bootstrap.pagination","ui.bootstrap.tpls","angular-click-outside","cfp.hotkeys","matchMedia","pascalprecht.translate"]),e.module("mindsmash-table").run(["$templateCache",function(e){e.put("msm-table-column-selector/msm-table-column-selector.html",'<div class="btn-group" uib-dropdown auto-close="outsideClick"><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading"><span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="col in vm.cols" role="menuitem" ng-class="{ \'disabled\': col.isSticky, \'msm-table-isSelected\': vm.visibility[col.key] }"><a href="#" ng-click="!col.isSticky && vm.select(col.key, $event)" translate="{{ col.name }}"></a></li></ul></div>'),e.put("msm-table-pager/msm-table-pager.html",'<uib-pager ng-model="vm.page" total-items="vm.rowCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pager.previous\' | translate }}" next-text="{{ \'msmTable.pager.next\' | translate }}"></uib-pager>'),e.put("msm-table-pagination/msm-table-pagination.html",'<uib-pagination ng-model="vm.page" total-items="vm.rowCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pagination.previous\' | translate }}" next-text="{{ \'msmTable.pagination.next\' | translate }}" rotate="true" max-size="5"></uib-pagination>'),e.put("msm-table-pagination-size/msm-table-pagination-size.html",'<div class="btn-group" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading">{{ vm.pageSize }} <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="pageSize in vm.pageSizes" role="menuitem" ng-class="{ \'msm-table-isSelected\': pageSize === vm.pageSize }"><a href="#" ng-click="vm.select(pageSize, $event)">{{ pageSize }}</a></li></ul></div>'),e.put("msm-table-view/msm-table-view.html",'<div><table id="{{ vm.name }}" class="table msm-table-table-view" ng-class="{ \'msm-table-isLoading\': vm.isLoading }" ng-if="!vm.isMobile" click-outside="vm.clearActive()"><thead><tr><th class="msm-table-selector-all" ng-show="vm.selectionEnabled"></th><th ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" ng-class="{\'msm-table-isSortable\': vm.orderByEnabled && col.isSortable !== false,\'msm-table-isSortedAsc\': vm.orderBy.key === col.key && vm.orderBy.asc === true,\'msm-table-isSortedDesc\': vm.orderBy.key === col.key && vm.orderBy.asc === false }" ng-click="vm.orderByEnabled && col.isSortable !== false && vm.setOrderBy(col.key)" translate="{{ col.name }}"></th></tr></thead><thead class="msm-table-loading-bar"><tr><td colspan="{{ vm.cols.length + 1 }}"><div class="msm-table-progress"><div class="msm-table-container"><div class="msm-table-bar msm-table-bar1"></div><div class="msm-table-bar msm-table-bar2"></div></div></div></td></tr></thead><tbody><tr ng-repeat="row in vm.rows" ng-class="{ \'msm-table-isActive\': vm.active === $index, \'msm-table-isSelected\': vm.selection[row.id] }" ng-click="vm.activeEnabled && vm.setActive($index)"><td class="msm-table-selector" ng-show="vm.selectionEnabled" ng-click="vm.setSelection(row[vm.selectionKey])"></td><td ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" data-label="{{ col.name }}" msm-table-view-cell>{{ row[col.key] }}</td></tr></tbody></table><ol class="list-unstyled msm-table-list-view" ng-if="vm.isMobile"><li ng-repeat="row in vm.rows" ng-include="vm.mobileTemplateUrl"></li></ol></div>')}]),e.module("mindsmash-table").directive("msmTableColumnSelector",t),e.module("mindsmash-table").provider("msmTableFactory",n),e.module("mindsmash-table").directive("msmTablePager",r),e.module("mindsmash-table").constant("msmTableConfig",{namespace:"msmTable",source:e.noop,columns:[],onAction:e.noop,onBeforeLoad:e.identity,onAfterLoad:e.identity,page:0,pageSizes:[10,25,50,100],orderBy:null,active:null,selection:"id",storage:"session",mobileSize:"xs",mobileTemplateUrl:null}),e.module("mindsmash-table").directive("msmTablePagination",s),e.module("mindsmash-table").directive("msmTablePaginationSize",m),e.module("mindsmash-table").directive("msmTableView",d),e.module("mindsmash-table").directive("msmTableViewCell",p)}(angular);
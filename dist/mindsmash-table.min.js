/**
 * @name mindsmash-table
 * @version v0.2.2
 * @author mindsmash GmbH
 * @license MIT
 */
!function(e){"use strict";function t(t,n){function a(t){e.merge(l,t)}function o(e,t,n){return new i(e,t,n,l)}o.$inject=["$rootScope","$q","$window"];var l=t;return n.translations("en",{"msmTable.pagination.previous":"«","msmTable.pagination.next":"»","msmTable.pager.previous":"« Previous","msmTable.pager.next":"Next »"}),{setTableConfig:a,$get:o}}function i(t,i,a,o){function l(l,r){return new n(t,i,a,l,e.merge(o,r))}return{get:l}}function n(t,i,n,a,o){function l(){return o}function r(){return K}function s(){return G}function c(){return G}function m(){return Q.rowCount}function u(){var e={page:Q.page,pageSize:Q.pageSize};return Q.orderBy&&(e.orderBy=Q.orderBy.key,e.orderAsc=Q.orderBy.asc),e}function d(){return R("loading",!0),o.source(o.onBeforeLoad(u())).then(function(e){e=o.onAfterLoad(e),G=e.content,R("items");var t={number:"page",size:"pageSize",totalElements:"rowCount",orderBy:"orderBy"};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],a=e[i];Q[n]!==a&&(Q[n]=a,R(n,a))}var l=V();null!==Q.active&&Q.active>=l&&(Q.active=l-1,R("active",Q.active))})["finally"](function(){R("loading",!1)})}function g(){var e=null!==I?I[K]:null;return e?JSON.parse(e):{}}function p(){null!==I&&(I[K]=JSON.stringify({page:Q.page,pageSize:Q.pageSize,orderBy:Q.orderBy}))}function v(){return Q.page}function b(e){var t=i.defer(),n=Math.min(Math.max(0,e),O()-1);return Q.page!==n?(Q.page=n,t.resolve(d())):t.reject(n),t.promise.then(function(e){return H("page",n),e})}function f(){return b(0)}function y(){return b(Q.page-1)}function $(){return b(Q.page+1)}function S(){return b(O()-1)}function h(){return Q.pageSize}function w(e){var t=i.defer(),n=Math.max(1,e);return Q.pageSize!==n?(Q.pageSize=n,t.resolve(d())):t.reject(n),t.promise.then(function(e){return H("pageSize",n),e})}function z(){return Q.orderBy}function k(t,n){var a,o=i.defer();return Q.orderBy?a=e.isUndefined(t)||null===t||null===n?null:Q.orderBy.key!==t?{key:t,asc:e.isUndefined(n)||!!n}:e.isDefined(n)&&Q.orderBy.asc!==n?{key:Q.orderBy.key,asc:n}:Q.orderBy.asc?{key:Q.orderBy.key,asc:!1}:null:e.isDefined(t)&&null!==t&&null!==n&&(a={key:t,asc:e.isUndefined(n)||!!n}),e.isDefined(a)?(Q.orderBy=a,o.resolve(d())):o.reject({key:t,asc:e.isUndefined(n)||!!n}),o.promise.then(function(e){return H("orderBy",a),e})}function B(){return k(null)}function A(){return Q.active}function T(e){var t,n=i.defer(),a=!1,o=!1,l=V();return null===e?t=null!==Q.active?null:Q.active:0>e?(a=Q.page>0,t=a?Q.pageSize-1:null!==e?0:null):e>=l?(o=Q.page<O()-1,t=o?0:null!==e?l-1:null):t=Math.min(e,G.length-1),Q.active!==t?(Q.active=t,a?n.resolve(y()):o?n.resolve($()):n.resolve()):n.reject(t),n.promise.then(function(e){return R("active",t),e})}function C(){return T(0)}function P(){return T(null!==Q.active?Q.active-1:0)}function L(){return T(null!==Q.active?Q.active+1:0)}function N(){return T(V()-1)}function x(){return T(null)}function E(t){return e.isDefined(t)?!!Q.visibility[t]:Q.visibility}function j(t,n){var a=i.defer(),o=e.isDefined(n)?!!n:!Q.visibility[t];if(Q.visibility[t]!==o)Q.visibility[t]=o,a.resolve();else{var l={};l[t]=o,a.reject(l)}return a.promise.then(function(e){return R("visibility",Q.visibility),e})}function U(t){return e.isDefined(t)?!!Q.selection[t]:Q.selection}function M(t,n){var a=i.defer(),o=e.isDefined(n)?!!n:!Q.selection[t];if(Q.selection[t]!==o)Q.selection[t]=o,a.resolve();else{var l={};l[t]=o,a.reject(l)}return a.promise.then(function(e){return R("selection",Q.selection),e})}function D(e){var t=i.defer();return null!==Q.active?M(G[Q.active][o.selection],e):void t.reject(e)}function q(){var e=i.defer();return Q.selection!=={}?(Q.selection={},e.resolve()):e.reject(),e.promise.then(function(e){return R("selection",Q.selection),e})}function O(){return Math.ceil(Q.rowCount/Q.pageSize)}function V(){return Q.page<O()-1?Q.pageSize:Q.rowCount%Q.pageSize}function R(e,i){t.$emit(K+"."+e,i)}function H(e,t){R(e,t),p()}var J=this,K=o.namespace+"."+a,F=o.columns,G=[],I=function(){return"session"===o.storage?sessionStorage:"local"===o.storage?localStorage:null}(),Q=e.extend({page:o.page,pageSize:o.pageSizes[0],rowCount:100,orderBy:o.orderBy,active:o.active,selection:{},visibility:function(){for(var e={},t=0;t<F.length;t++)e[F[t].key]=!F[t].isHidden;return e}()},g());J.getConfig=l,J.getName=r,J.getCols=s,J.getRows=c,J.getRowCount=m,J.reload=d,J.getPage=v,J.setPage=b,J.firstPage=f,J.previousPage=y,J.nextPage=$,J.lastPage=S,J.getPageSize=h,J.setPageSize=w,o.orderBy!==!1&&(J.getOrderBy=z,J.setOrderBy=k,J.clearOrderBy=B),o.active!==!1&&(J.getActive=A,J.setActive=T,J.firstActive=C,J.previousActive=P,J.nextActive=L,J.lastActive=N,J.clearActive=x),J.getVisibility=E,J.setVisibility=j,o.selection!==!1&&(J.getSelection=U,J.setSelection=M,J.clearSelection=q,o.active!==!1&&(J.setActiveSelection=D)),J.reload()}function a(){return{restrict:"E",controller:o,controllerAs:"vm",templateUrl:"msm-table-column-selector/msm-table-column-selector.html",scope:{api:"&"}}}function o(e,t){function i(e,t){t.preventDefault();var i=!n.visibility[e];if(!i)for(var o=Object.keys(n.visibility);!i&&o.length>0;){var l=o.shift();i=l!==e&&n.visibility[l]}return i?a.setVisibility(e):void 0}var n=this,a=t.api(),o=a.getConfig();n.isLoading=!1,n.cols=o.columns,n.visibility=a.getVisibility(),n.select=i;var l=e.$on(a.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(a.getName()+".visibility",function(e,t){n.visibility=t});t.$on("$destroy",l),t.$on("$destroy",r)}function l(){return{restrict:"E",controller:r,controllerAs:"vm",templateUrl:"msm-table-pager/msm-table-pager.html",scope:{api:"&"}}}function r(e,t){var i=this,n=1,a=t.api();a.getConfig();i.isLoading=!1,i.page=a.getPage()+n,i.pageSize=a.getPageSize(),i.rowCount=a.getRowCount(),t.$watch("vm.page",function(e,t){a.setPage(e-n)});var o=e.$on(a.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(a.getName()+".page",function(e,t){i.page=t+n}),r=e.$on(a.getName()+".pageSize",function(e,t){i.pageSize=t}),s=e.$on(a.getName()+".rowCount",function(e,t){i.rowCount=t});t.$on("$destroy",o),t.$on("$destroy",l),t.$on("$destroy",r),t.$on("$destroy",s)}function s(){return{restrict:"E",controller:c,controllerAs:"vm",templateUrl:"msm-table-pagination/msm-table-pagination.html",scope:{api:"&"}}}function c(e,t){var i=this,n=1,a=t.api();a.getConfig();i.isLoading=!1,i.page=a.getPage()+n,i.pageSize=a.getPageSize(),i.rowCount=a.getRowCount(),t.$watch("vm.page",function(e,t){a.setPage(e-n)});var o=e.$on(a.getName()+".loading",function(e,t){i.isLoading=t}),l=e.$on(a.getName()+".page",function(e,t){i.page=t+n}),r=e.$on(a.getName()+".pageSize",function(e,t){i.pageSize=t}),s=e.$on(a.getName()+".rowCount",function(e,t){i.rowCount=t});t.$on("$destroy",o),t.$on("$destroy",l),t.$on("$destroy",r),t.$on("$destroy",s)}function m(){return{restrict:"E",controller:u,controllerAs:"vm",templateUrl:"msm-table-pagination-size/msm-table-pagination-size.html",scope:{api:"&"}}}function u(e,t){function i(e,t){t.preventDefault(),n.pageSize=e,a.setPageSize(e)}var n=this,a=t.api(),o=a.getConfig();n.isLoading=!1,n.pageSize=a.getPageSize(),n.pageSizes=o.pageSizes,n.select=i;var l=e.$on(a.getName()+".loading",function(e,t){n.isLoading=t}),r=e.$on(a.getName()+".pageSize",function(e,t){n.pageSize=t});t.$on("$destroy",l),t.$on("$destroy",r)}function d(){return{restrict:"E",controller:g,controllerAs:"vm",templateUrl:"msm-table-view/msm-table-view.html",scope:{api:"&"}}}function g(e,t,i,n,a){function o(e,t){return i("filter")(e,function(e){return t[e.key]})}function l(){return null===m.active?u.lastActive():u.firstActive()}function r(){return null===m.active?u.firstActive():u.lastActive()}function s(e){return d.onAction(m.rows[u.getActive()],e)}function c(e,t){return function(i){m.isLoading||t&&null===u.getActive()||(i.preventDefault(),e())}}var m=this,u=t.api(),d=u.getConfig();m.isLoading=!1,m.name=u.getName(),m.cols=o(d.columns,u.getVisibility()),m.rows=u.getRows(),m.orderByEnabled=d.orderBy!==!1,m.orderByEnabled&&(m.orderBy=u.getOrderBy(),m.setOrderBy=u.setOrderBy),m.activeEnabled=d.active!==!1,m.activeEnabled&&(m.active=u.getActive(),m.setActive=u.setActive,m.clearActive=u.clearActive),m.selectionEnabled=d.selection!==!1,m.selectionEnabled&&(m.selectionKey=d.selection,m.selection=u.getSelection(),m.setSelection=u.setSelection,m.clearSelection=u.clearSelection),m.isMobile=!1,m.mobileSize=d.mobileSize,m.mobileTemplateUrl=d.mobileTemplateUrl,m.mobileSize&&m.mobileTemplateUrl&&(m.isMobile=a.is(m.mobileSize),a.on(m.mobileSize,function(e){m.isMobile!==e&&(m.isMobile=e)})),n.bindTo(t).add({combo:"shift+left",callback:c(u.firstPage)}).add({combo:"left",callback:c(u.previousPage)}).add({combo:"right",callback:c(u.nextPage)}).add({combo:"shift+right",callback:c(u.lastPage)}),m.activeEnabled&&n.bindTo(t).add({combo:"shift+up",callback:c(l)}).add({combo:"up",callback:c(u.previousActive,!0)}).add({combo:"down",callback:c(u.nextActive,!0)}).add({combo:"shift+down",callback:c(r)}).add({combo:"esc",callback:u.clearActive}).add({combo:"return",callback:c(s,!0)}),m.selectionEnabled&&n.bindTo(t).add({combo:"shift+esc",callback:u.clearSelection}),m.activeEnabled&&m.selectionEnabled&&n.bindTo(t).add({combo:"space",callback:c(u.setActiveSelection)});var g=e.$on(u.getName()+".loading",function(e,t){m.isLoading=t}),p=e.$on(u.getName()+".items",function(e){m.rows=u.getRows()}),v=e.$on(u.getName()+".orderBy",function(e,t){m.orderBy=t}),b=e.$on(u.getName()+".active",function(e,t){m.active=t}),f=e.$on(u.getName()+".visibility",function(e,t){m.cols=o(d.columns,t)}),y=e.$on(u.getName()+".selection",function(e,t){m.selection=t});t.$on("$destroy",g),t.$on("$destroy",p),t.$on("$destroy",v),t.$on("$destroy",b),t.$on("$destroy",f),t.$on("$destroy",y)}function p(t,i){return{restrict:"A",require:"^msmTableView",scope:!1,link:function(n,a,o){var l=n.col.templateUrl,r=n.col.template;e.isDefined(l)?i(l).then(function(e){a[0].innerHTML=e,t(a.contents())(n)}):e.isDefined(r)&&(a[0].innerHTML=r,t(a.contents())(n))}}}t.$inject=["msmTableConfig","$translateProvider"],o.$inject=["$rootScope","$scope"],r.$inject=["$rootScope","$scope"],c.$inject=["$rootScope","$scope"],u.$inject=["$rootScope","$scope"],g.$inject=["$rootScope","$scope","$filter","hotkeys","screenSize"],p.$inject=["$compile","$templateRequest"],e.module("mindsmash-table",["ui.bootstrap.dropdown","ui.bootstrap.pager","ui.bootstrap.pagination","ui.bootstrap.tpls","angular-click-outside","cfp.hotkeys","matchMedia","pascalprecht.translate"]),e.module("mindsmash-table").run(["$templateCache",function(e){e.put("msm-table-column-selector/msm-table-column-selector.html",'<div class="btn-group" uib-dropdown auto-close="outsideClick"><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading"><span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="msm-table-square"></span> <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="col in vm.cols" role="menuitem" ng-class="{ \'disabled\': col.isSticky, \'msm-table-isSelected\': vm.visibility[col.key] }"><a href="#" ng-click="!col.isSticky && vm.select(col.key, $event)" translate="{{ col.name }}"></a></li></ul></div>'),e.put("msm-table-pager/msm-table-pager.html",'<uib-pager ng-model="vm.page" total-items="vm.rowCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pager.previous\' | translate }}" next-text="{{ \'msmTable.pager.next\' | translate }}"></uib-pager>'),e.put("msm-table-pagination/msm-table-pagination.html",'<uib-pagination ng-model="vm.page" total-items="vm.rowCount" items-per-page="vm.pageSize" ng-disabled="vm.isLoading" previous-text="{{ \'msmTable.pagination.previous\' | translate }}" next-text="{{ \'msmTable.pagination.next\' | translate }}" rotate="true" max-size="5"></uib-pagination>'),e.put("msm-table-pagination-size/msm-table-pagination-size.html",'<div class="btn-group" uib-dropdown><button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="vm.isLoading">{{ vm.pageSize }} <span class="caret"></span></button><ul uib-dropdown-menu role="menu"><li ng-repeat="pageSize in vm.pageSizes" role="menuitem" ng-class="{ \'msm-table-isSelected\': pageSize === vm.pageSize }"><a href="#" ng-click="vm.select(pageSize, $event)">{{ pageSize }}</a></li></ul></div>'),e.put("msm-table-view/msm-table-view.html",'<div><table id="{{ vm.name }}" class="table msm-table-table-view" ng-class="{ \'msm-table-isLoading\': vm.isLoading }" ng-if="!vm.isMobile" click-outside="vm.clearActive()"><thead><tr><th class="msm-table-selector-all" ng-show="vm.selectionEnabled"></th><th ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" ng-class="{\'msm-table-isSortable\': vm.orderByEnabled && col.isSortable !== false,\'msm-table-isSortedAsc\': vm.orderBy.key === col.key && vm.orderBy.asc === true,\'msm-table-isSortedDesc\': vm.orderBy.key === col.key && vm.orderBy.asc === false }" ng-click="vm.orderByEnabled && col.isSortable !== false && vm.setOrderBy(col.key)" translate="{{ col.name }}"></th></tr></thead><thead class="msm-table-loading-bar"><tr><td colspan="{{ vm.cols.length + 1 }}"><div class="msm-table-progress"><div class="msm-table-container"><div class="msm-table-bar msm-table-bar1"></div><div class="msm-table-bar msm-table-bar2"></div></div></div></td></tr></thead><tbody><tr ng-repeat="row in vm.rows" ng-class="{ \'msm-table-isActive\': vm.active === $index, \'msm-table-isSelected\': vm.selection[row.id] }" ng-click="vm.activeEnabled && vm.setActive($index)"><td class="msm-table-selector" ng-show="vm.selectionEnabled" ng-click="vm.setSelection(row[vm.selectionKey])"></td><td ng-repeat="col in vm.cols | filter : vm.visibility[col.key]" data-label="{{ col.name }}" msm-table-view-cell>{{ row[col.key] }}</td></tr></tbody></table><ol class="list-unstyled msm-table-list-view" ng-if="vm.isMobile"><li ng-repeat="row in vm.rows" ng-include="vm.mobileTemplateUrl"></li></ol></div>')}]),e.module("mindsmash-table").provider("msmTableFactory",t),e.module("mindsmash-table").directive("msmTableColumnSelector",a),e.module("mindsmash-table").directive("msmTablePager",l),e.module("mindsmash-table").constant("msmTableConfig",{namespace:"msmTable",source:e.noop,columns:[],onAction:e.noop,onBeforeLoad:e.identity,onAfterLoad:e.identity,page:0,pageSizes:[10,25,50,100],orderBy:null,active:null,selection:"id",storage:"session",mobileSize:"xs",mobileTemplateUrl:null}),e.module("mindsmash-table").directive("msmTablePagination",s),e.module("mindsmash-table").directive("msmTablePaginationSize",m),e.module("mindsmash-table").directive("msmTableView",d),e.module("mindsmash-table").directive("msmTableViewCell",p)}(angular);